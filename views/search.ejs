<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Search: <%= search %></title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="/all.min.css">

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
    }
    .section {
      max-width: 900px;
      margin: 0 auto;
    }

    .card {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }

    .card h2 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 20px;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    li {
      padding: 8px 0;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #333;
    }

    li:last-child {
      border-bottom: none;
    }

    li a {
      color: #90caf9;
      text-decoration: none;
    }

    li a:hover {
      text-decoration: underline;
    }

    .favicon {
      margin-right: 10px;
      width: 16px;
      height: 16px;
    }

    .empty {
      color: #888;
      font-style: italic;
    }

    span.category-link a {
      color: #80cbc4;
      text-decoration: none;
    }

    span.category-link a:hover {
      text-decoration: underline;
    }

    .delete-btn {
      margin-left: auto;
      background: none;
      border: none;
      color: #ef5350;
      cursor: pointer;
      font-size: 16px;
      padding: 4px;
      display: flex;
      align-items: center;
    }

    .delete-btn:hover {
        background: #ef5350;
        color: #fff;
    }

    .stats {
        margin-left: auto;
        font-size: 12px;
        color: #aaa;
        text-align: right;
        white-space: nowrap;
    }
    button:hover {
      cursor: pointer;
    }
    #cancel-delete {
      display: inline-block;
      padding: 0.6rem 1rem;
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
      background: linear-gradient(#6e6e6e, #4a4a4a); /* grauer Verlauf */
      border: 0;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms;
    }
    #confirm-delete {
      display: inline-block;
      padding: 0.6rem 1rem;
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
      background: linear-gradient(#ff4d4f, #d9363e);
      border: 0;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(217, 57, 62, 0.25);
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms;
    }
    h1,h2 { text-align:center; color:#fff; }
    a { color:#90caf9; text-decoration:none; }
    a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <center>
    <h1>
      <a class="text-link" href="/">Bookmarks</a>
    </h1>
  </center>
  <!-- Search Bar -->
  <div class="section">
    <form action="/search" method="GET" style="display:flex; justify-content:center; margin-bottom:20px;">
      <input type="text" name="q" placeholder="Search categories or links..." value="<%= search || '' %>" style="padding:8px 12px; width:300px; border-radius:6px 0 0 6px; border:1px solid #333; background:#1e1e1e; color:#fff; outline:none;">
      <button type="submit" style="padding:8px 12px; border-radius:0 6px 6px 0; border:1px solid #333; border-left:none; background:#1e88e5; color:#fff;">Search</button>
    </form>
  </div>

  <h1>Search results for "<%= search %>"</h1>

  <div class="section">

    <!-- Categories -->
    <div class="card">
    <h2><i class="fa-solid fa-folder"></i> Categories</h2>
    <% if (categories.length) { %>
        <ul>
        <% categories.forEach(c => { %>
        <li style="display:flex; align-items:center; justify-content:space-between;">
            <a href="/category/<%= c.id %>"><%= c.name %></a>
            <form action="/category/<%= c.id %>/delete" method="POST" style="margin:0;" onsubmit="event.preventDefault(); showDeleteModal(this);">
                <button type="submit" class="delete-btn" title="Delete"><i class="fa-solid fa-trash"></i></button>
            </form>
        </li>
        <% }) %>
        </ul>
    <% } else { %>
        <p class="empty">No categories found.</p>
    <% } %>
    </div>

    <!-- Links -->
    <div class="card">
    <h2><i class="fa-solid fa-link"></i> Links</h2>
    <% if (links.length) { %>
        <ul>
        <% links.forEach(l => { %>
            <li style="display:flex; align-items:center; justify-content:space-between;">
            <div style="display:flex; align-items:center; gap:8px;">
                <% if (l.favicon) { %>
                <div style="width:16px; height:16px; display:inline-block; position:relative;">
                    <img src="<%= l.favicon %>" alt="favicon"
                        style="width:16px; height:16px; display:block;"
                        onerror="this.style.display='none'; this.parentElement.querySelector('i').style.display='block';">
                    <i class="fa-solid fa-link"
                    style="position:absolute; top:0; left:0; width:16px; height:16px; display:none;"></i>
                </div>
                <% } %>
                <a href="/link/<%= l.id %>/go" style="overflow: hidden; width: 550px; white-space: nowrap; text-overflow: ellipsis;" target="_blank">
                <%= l.title %>
                </a>
            </div>
            <div style="display:flex; align-items:center; gap:8px;">
                <!-- Category Link -->
                <span class="category-link">
                in <a href="/category/<%= l.category_id %>">Category</a>
                </span>

                <!-- Stats Button -->
                <button class="delete-btn stats-btn" data-visits="<%= l.visits %>" data-created="<%= l.created_at %>" title="View stats">
                    <i class="fa-solid fa-chart-line"></i>
                </button>

                <!-- Delete Button -->
                <form action="/link/<%= l.id %>/delete" method="POST" style="margin:0;" id="delete-form-<%= l.id %>">
                    <button type="button" class="delete-btn" title="Delete" onclick="showDeleteModal(this.form)"><i class="fa-solid fa-trash"></i></button>
                </form>
            </div>
            </li>
        <% }) %>
        </ul>
    <% } else { %>
        <p class="empty">No links found.</p>
    <% } %>
    </div>

    <div id="delete-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000;">
    <div style="background:#1e1e1e; padding:20px; border-radius:8px; max-width:300px; width:100%; text-align:center; position:relative;">
        <p>Are you sure you want to delete this item?</p>
        <button id="cancel-delete" style="margin:5px;">Cancel</button>
        <button id="confirm-delete" style="margin:5px;">Delete</button>
    </div>
    </div>

    <!-- Modal -->
    <div id="stats-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000;">
        <div style="background:#1e1e1e; padding:20px; border-radius:8px; max-width:300px; width:100%; text-align:center; position:relative;">
            <h3>Link Statistics</h3>
            <p id="modal-content"></p>
            <button id="close-modal" style="position:absolute; top:10px; right:10px; background:none; border:none; color:#fff; font-size:18px; cursor:pointer;"><i class="fa-solid fa-xmark"></i></button>
        </div>
    </div>

    <script>
    let deleteForm = null;
    const deleteModal = document.getElementById('delete-modal');
    const cancelDelete = document.getElementById('cancel-delete');
    const confirmDelete = document.getElementById('confirm-delete');

    function showDeleteModal(form) {
        deleteForm = form;
        deleteModal.style.display = 'flex';
    }

    function hideDeleteModal() {
        deleteForm = null;
        deleteModal.style.display = 'none';
    }

    cancelDelete.addEventListener('click', hideDeleteModal);
    confirmDelete.addEventListener('click', () => {
        if (deleteForm) deleteForm.submit();
    });

    deleteModal.addEventListener('click', (e) => {
        if(e.target === deleteModal) hideDeleteModal();
    });

    document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape') hideDeleteModal();
    });

    const modal = document.getElementById('stats-modal');
    const modalContent = document.getElementById('modal-content');
    const closeModal = document.getElementById('close-modal');
    document.querySelectorAll('.stats-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const visits = btn.dataset.visits || 0;
            const created = btn.dataset.created || 'unknown';
            modalContent.innerHTML = `Visits: ${visits}<br>Added: ${created}`;
            modal.style.display = 'flex';
        });
    });
    closeModal.addEventListener('click', () => {
        modal.style.display = 'none';
    });
    modal.addEventListener('click', (e) => {
        if(e.target === modal) modal.style.display = 'none';
    });
    </script>

  </div>

</body>
</html>
